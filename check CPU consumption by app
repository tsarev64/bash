#!/bin/bash
# -gt больше
# -ge больше или равно
# -lt меньше
#Переменные
#Задаем переменную времени и даты.
d=$(date +%d.%m.%Y\ %H:%M:%S)
#Переменная названия приложения
app_name="openam"
#Переменная лимита, с этим значением сравнивается потребление ресурса приложением.
cpu_limit="5380"
#Переменная в которую записывается потребление CPU
# ps aux  выводит список приложений и их потребление ресурсов
# grep $app_name из вывода ps aux мы ищем наше приложение
#grep -v grep означает, что в вывод команды не включается grep, используемый для фильтрации.
#awk {'print $3*100'} выбирет значения из 3 столбца и умножает на 100 для получения целого числа
#Столбцы разделены пробелами, для памяти будет 4.
app_cpu_have=`ps aux | grep $app_name | grep -v grep | awk {'print $3*100'}`
#declare используется для того чтобы вывести значение переменной или функции, используется т.н. re-usable вывод, т.к. такой же как и при объявлении: выведенный код можно испольозвать для повторного объявления переменной/функции и т.д.
declare -i app_cpu_have
declare -i app_cpu
declare -i cpu_limit

#условие вывод в файл, но можно задать любое условие.

if [[ $app_cpu_have -gt $cpu_limit ]];
then
echo ""$d"Утилизация CPU превысила допустимую норму" >> top.txt
else
echo ""$d"Утилизация CPU не превышает допустимую норму" >> top.txt
fi
